
# DNSの概要

DNS (Domain Name System) は、インターネット上で人間が使いやすいドメイン名（例: `example.com`）を、コンピュータが理解できるIPアドレス（例: `192.168.1.1`や`2001:0db8:85a3::8a2e:0370:7334`）に変換するためのシステム。
DNSは、インターネットの「電話帳」のような役割を果たしており、ユーザーがドメイン名を使ってウェブサイトにアクセスできるようにする。

## DNSの基本的な仕組み

1. **ブラウザがDNSクエリを開始**
   - ユーザーがURL（例: `www.example.com`）を入力します。ブラウザはまず、PCやブラウザ自体の**DNSキャッシュ**を確認します。
   - キャッシュにIPアドレスがない場合、次のステップに進みます。

2. **再帰的DNSサーバーへの問い合わせ**
   - ブラウザやOSは、ISP（インターネットサービスプロバイダー）やGoogle Public DNSなどの**再帰的DNSサーバー**に問い合わせを送ります。このサーバーが、ドメイン名に対応するIPアドレスを見つけるために必要な一連の問い合わせを代行します。

3. **再帰的DNSサーバーがルートサーバーに問い合わせ**
   - 再帰的DNSサーバーは、まず**ルートDNSサーバー**に問い合わせを行います。このサーバーはインターネット全体で13の識別名（A-rootからM-root）がありますが、物理的には世界中に数百台のサーバーが存在しています。
   - **ルートサーバーの役割**は、特定のTLD（例: `.com`, `.net`, `.org` など）を管理するTLDサーバーの情報を提供することです。

4. **TLDサーバーへの問い合わせ**
   - ルートサーバーから受け取った情報を基に、再帰的DNSサーバーは**TLDサーバー**（例: `.com`を管理しているサーバー）に問い合わせを行います。
   - このサーバーは、該当するドメイン名（`example.com`）を管理している**権威DNSサーバー**の場所を教えます。

5. **権威DNSサーバーへの問い合わせ**
   - TLDサーバーからの情報を基に、再帰的DNSサーバーは、最終的に**権威DNSサーバー**に問い合わせを行います。権威DNSサーバーは、ドメイン名に対応する正しいIPアドレスを持っているサーバーです。
   - ここで、例えば`www.example.com`に対応するIPアドレスが返されます。

6. **再帰的DNSサーバーがIPアドレスをブラウザに返す**
   - 再帰的DNSサーバーは、取得したIPアドレスをブラウザに返します。

7. **ブラウザがIPアドレスを使ってウェブサーバーに接続**
   - 最終的にブラウザは、そのIPアドレスを使って目的のウェブサーバーに接続し、ウェブページを表示します。

### DNSの階層構造

つまり、DNSは階層的な構造を持っており、各レベルが異なる役割を果たしています。

1. **ルートDNSサーバー**
   - ルートサーバーは、インターネットの最上位に位置し、TLDサーバーの場所を指し示す役割を果たします。全世界に13のルートサーバー名がありますが、それぞれは複数の物理サーバーで構成されています。ルートサーバーは、特定のドメインに関連する**トップレベルドメイン（TLD）**サーバーの場所を教える役割を担っています。

2. **TLD DNSサーバー**
   - トップレベルドメイン（TLD）に対応するサーバーで、例えば`.com`, `.net`, `.org`, `.jp`など、ドメインの末尾部分を管理しています。このサーバーは、そのTLDに属するドメインの権威DNSサーバーを指し示します。

3. **権威DNSサーバー**
   - 各個別のドメイン名（例: `example.com`）を管理するサーバーです。権威DNSサーバーは、そのドメインに対応するIPアドレスやその他のリソースレコードを保持しており、最終的な答えを提供します。

### DNSのキャッシング

DNSのキャッシングは、IPアドレスを効率よく再利用し、インターネット接続を高速化するための仕組みです。

- **キャッシングの仕組み**  一度問い合わせたドメイン名とIPアドレスの対応情報は、再帰的DNSサーバーやクライアント側のブラウザやOSによって一時的に保存されます。この情報が有効な間、再び同じドメイン名にアクセスすると、再度DNS問い合わせを行わずにキャッシュされた情報を利用します。
- **TTL（Time To Live）**  各DNSレコードにはTTL（生存時間）が設定されており、キャッシュされた情報がどのくらいの期間有効かが指定されています。TTLが切れると、再度DNSサーバーに問い合わせが行われます。

### DNSのセキュリティと問題

- **DNSキャッシュポイズニング**  悪意ある攻撃者が偽のIPアドレスをDNSキャッシュに注入し、ユーザーを偽のウェブサイトに誘導する攻撃です。
- **DNS over HTTPS（DoH）**  DNSクエリをHTTPSプロトコルを使って暗号化する技術で、通信内容の盗聴や改ざんを防ぎ、ユーザーのプライバシーを保護します。
